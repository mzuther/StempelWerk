{% macro render(table, table_columns, common, name) %}
-- ========================================================================== --
-- {{ name.description }}
-- ========================================================================== --

-- this file was auto-generated from the following template:
-- 10-templates/00-stencils/10-sql_create_table.sql.jinja


DROP TABLE IF EXISTS {{ table.schema }}.{{ table.target }};

CREATE TABLE {{ table.schema }}.{{ table.target }}
(
{% for column in table_columns -%}
{%- if column.comment %}
    -- {{ column.comment }}
{% endif -%}
{{- '    %-15s  %s' | format(column.name, column.type) }}
{{- (' DEFAULT ' + column.default) if column.default }}
{{- ' NOT NULL' if column.primary or column.not_null }},
{% if column.separator and not loop.last %}
    -- -------------------------------------------------- --
{% endif %}
{% endfor %}
{%- for column in ( table_columns | selectattr('primary') | sort(attribute='primary') ) -%}
{% if loop.first %}

    -- add primary key
    CONSTRAINT PK_{{ table.target }}
    PRIMARY KEY CLUSTERED
    (
{% endif %}
        {{ column.name }}
        {{- ',' if not loop.last }}
{% if loop.last %}
    )
{% endif %}
{%- endfor %}
);

ALTER AUTHORIZATION ON OBJECT::{{ table.schema }}.{{ table.target }} TO SCHEMA OWNER;
GO
{% endmacro %}
